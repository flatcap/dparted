Moving data


OLD METHOD:
	Start:
		Partition 50% full (evenly distributed)
		move_50_old.svg (1)

	End:
		Partition 1/2 size, at offset 1/2 size
		move_50_old.svg (4)

	Actions:
		Run resize to 50%
		move_50_old.svg (2,3)

		Byte-copy partition to new location
		move_50_old.svg (4)

NEW METHOD:
	Start:
		Partition 50% full (evenly distributed)
		move_50_new.svg (1)

	End:
		Partition 1/2 size, at offset 1/2 size
		move_50_new.svg (3)

	Actions:
		Move lower half of data into upper region (live)
		move_50_new.svg (2)
		Create new metadata in-place (live)
		move_50_new.svg (X)
		Shrink partition (offline)
		move_50_new.svg (3)

move_75_new.svg
move_75_old.svg


Comparing move strategies

	Source: fs filled with X% data (0xAA), space filled (0xBB)
	Dest:	filled (0xCC)

	Optimal result:
		count (0xCC) == count (0xBB)
		count (0xAA) == count (0xAA)
		count (other meta) == count (other meta)

Notes:
	Resize2fs can move blocks
	mke2fs knows where to put metadata

